<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>rust canvas game</title>

<link rel="modulepreload" href="/game_canvas-f5bb96cb35386dd2.js" crossorigin=anonymous integrity="sha384-9QCptloYQ5j8SS9LHfrPcM27tvAIUZQrqGIt2vT7i+uCs4t5UagQeXA8bxc9n/2D">
<link rel="preload" href="/game_canvas-f5bb96cb35386dd2_bg.wasm" crossorigin=anonymous integrity="sha384-MxqidDZEva//oU/lq5A1cuRGNmBwMEQM4XJWORbnG8CHWDYbhFdq2pFgmzISvd+v" as="fetch" type="application/wasm"></head>
<body style="background-color: #282b2e; display: flex; flex-direction: column; justify-content: center; align-items: center">
    <canvas id="gameCanvas" width="800" height="800"></canvas>
    <script type="module">
			import init from "./pkg/game_canvas.js";

			let wasm;

			async function start() {
				wasm = await init();
				document.addEventListener('keydown', handleKeyDown);
				document.addEventListener('keyup', handleKeyUp);
				wasm.initialize()
				requestAnimationFrame(gameloop);
			}

			function handleKeyDown(event) {
				event.preventDefault()
				switch (event.code) {
					case 'ArrowRight':
						wasm.move_right()
						break
					case 'ArrowLeft':
						wasm.move_left()
						break
					case 'ArrowUp':
						wasm.move_up()
						break
					case 'ArrowDown':
						wasm.move_down()
						break
					case 'KeyX':
						wasm.jump()
						break
				}
			}
			function handleKeyUp(event) {
				switch (event.code) {
					case 'ArrowLeft':
						wasm.stop_left()
						break
					case 'ArrowRight':
						wasm.stop_right()
						break
					case 'ArrowUp':
						wasm.stop_up()
						break
					case 'ArrowDown':
						wasm.stop_down()
						break
					case 'KeyX':
						wasm.stop_jumping()
						break
				}
			}

			function gameloop(timestamp) {
				try {
						wasm.update(); 
						wasm.render(); 
				} catch (error) {
						console.error('Error in game loop:', error);
				} 

				requestAnimationFrame(gameloop); 
			}

			start();
    </script>

<script type="module" nonce="F/bTbSpDgIAPeVGanuMsXA==">
import init, * as bindings from '/game_canvas-f5bb96cb35386dd2.js';
const wasm = await init('/game_canvas-f5bb96cb35386dd2_bg.wasm');


window.wasmBindings = bindings;


dispatchEvent(new CustomEvent("TrunkApplicationStarted", {detail: {wasm}}));

</script></body>
</html>
