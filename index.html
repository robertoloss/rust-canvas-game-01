<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>rust canvas game</title>
</head>
<body style="background-color: gray; display: flex; flex-direction: column; justify-content: center; align-items: center">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script type="module">
			import init from "./pkg/game_canvas.js";

			let wasm;

			async function start() {
				wasm = await init();
				document.addEventListener('keydown', handleKeyDown);
				//wasm.initialize()
				requestAnimationFrame(gameloop);
			}

			function handleKeyDown(event) {
				if (event.code === 'ArrowRight') {
					event.preventDefault()
					wasm.move_right();
				} else if (event.code === 'ArrowLeft') {
					event.preventDefault()
					wasm.move_left();
				} else if (event.code === 'ArrowUp') {
					event.preventDefault()
					wasm.move_up();
				} else if (event.code === 'ArrowDown') {
					event.preventDefault()
					wasm.move_down();
				}
			}
			

			function gameloop(timestamp) {
				try {
						wasm.update(); 
						wasm.render(); 
				} catch (error) {
						console.error('Error in game loop:', error);
				} 

				requestAnimationFrame(gameloop); 
			}

			start();
    </script>
</body>
</html>
