<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>rust canvas game</title>
</head>
<body style="background-color: #282b2e; display: flex; flex-direction: column; justify-content: center; align-items: center">
    <canvas id="gameCanvas" width="800" height="800"></canvas>
    <script type="module">
			import init from "./pkg/game_canvas.js";

			let wasm;

			async function start() {
				wasm = await init();
				document.addEventListener('keydown', handleKeyDown);
				document.addEventListener('keyup', handleKeyUp);
				wasm.initialize()
				requestAnimationFrame(gameloop);
			}

			function handleKeyDown(event) {
				event.preventDefault()
				switch (event.code) {
					case 'ArrowRight':
						wasm.move_right()
						break
					case 'ArrowLeft':
						wasm.move_left()
						break
					case 'ArrowUp':
						wasm.move_up()
						break
					case 'ArrowDown':
						wasm.move_down()
						break
					case 'KeyX':
						if (event.repeat) break
						wasm.jump()
						break
				}
			}
			function handleKeyUp(event) {
				switch (event.code) {
					case 'ArrowLeft':
						wasm.stop_left()
						break
					case 'ArrowRight':
						wasm.stop_right()
						break
					case 'ArrowUp':
						wasm.stop_up()
						break
					case 'ArrowDown':
						wasm.stop_down()
						break
					case 'KeyX':
						wasm.stop_jumping()
						break
				}
			}

			function gameloop(timestamp) {
				try {
						wasm.update(); 
						wasm.render(); 
				} catch (error) {
						console.error('Error in game loop:', error);
				} 

				requestAnimationFrame(gameloop); 
			}

			start();
    </script>
</body>
</html>
